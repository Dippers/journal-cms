elifeUpdatePipeline(
    { commit ->
        lock('journal-cms--ci') {
            builderDeployRevision 'journal-cms--ci', commit
            builderCmd "journal-cms--ci", "composer update drupal/core symfony/config --with-dependencies", "/srv/journal-cms"
            builderSync "ci--journal-cms.elifesciences.org", "/srv/journal-cms/"
            sh "git add composer.lock"
        }
    },
    {
        def subrepositorySummary = elifeGitSubrepositorySummary 'vendor/drupal/core'
        return "Updated drupal/core to ${subrepositorySummary}"
    },
    'update_drupal/'
)
